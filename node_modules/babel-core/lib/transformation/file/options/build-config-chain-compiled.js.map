{"version":3,"sources":["build-config-chain.js"],"names":[],"mappings":"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","file":"build-config-chain-compiled.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _assign = require(\"babel-runtime/core-js/object/assign\");\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nexports.default = buildConfigChain;\n\nvar _resolve = require(\"../../../helpers/resolve\");\n\nvar _resolve2 = _interopRequireDefault(_resolve);\n\nvar _json = require(\"json5\");\n\nvar _json2 = _interopRequireDefault(_json);\n\nvar _pathIsAbsolute = require(\"path-is-absolute\");\n\nvar _pathIsAbsolute2 = _interopRequireDefault(_pathIsAbsolute);\n\nvar _path = require(\"path\");\n\nvar _path2 = _interopRequireDefault(_path);\n\nvar _fs = require(\"fs\");\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar existsCache = {};\nvar jsonCache = {};\n\nvar BABELIGNORE_FILENAME = \".babelignore\";\nvar BABELRC_FILENAME = \".babelrc\";\nvar PACKAGE_FILENAME = \"package.json\";\n\nfunction exists(filename) {\n  var cached = existsCache[filename];\n  if (cached == null) {\n    return existsCache[filename] = _fs2.default.existsSync(filename);\n  } else {\n    return cached;\n  }\n}\n\nfunction buildConfigChain() {\n  var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var log = arguments[1];\n\n  var filename = opts.filename;\n  var builder = new ConfigChainBuilder(log);\n\n  if (opts.babelrc !== false) {\n    builder.findConfigs(filename);\n  }\n\n  builder.mergeConfig({\n    options: opts,\n    alias: \"base\",\n    dirname: filename && _path2.default.dirname(filename)\n  });\n\n  return builder.configs;\n}\n\nvar ConfigChainBuilder = function () {\n  function ConfigChainBuilder(log) {\n    (0, _classCallCheck3.default)(this, ConfigChainBuilder);\n\n    this.resolvedConfigs = [];\n    this.configs = [];\n    this.log = log;\n  }\n\n  ConfigChainBuilder.prototype.findConfigs = function findConfigs(loc) {\n    if (!loc) return;\n\n    if (!(0, _pathIsAbsolute2.default)(loc)) {\n      loc = _path2.default.join(process.cwd(), loc);\n    }\n\n    var foundConfig = false;\n    var foundIgnore = false;\n\n    while (loc !== (loc = _path2.default.dirname(loc))) {\n      if (!foundConfig) {\n        var configLoc = _path2.default.join(loc, BABELRC_FILENAME);\n        if (exists(configLoc)) {\n          this.addConfig(configLoc);\n          foundConfig = true;\n        }\n\n        var pkgLoc = _path2.default.join(loc, PACKAGE_FILENAME);\n        if (!foundConfig && exists(pkgLoc)) {\n          foundConfig = this.addConfig(pkgLoc, \"babel\", JSON);\n        }\n      }\n\n      if (!foundIgnore) {\n        var ignoreLoc = _path2.default.join(loc, BABELIGNORE_FILENAME);\n        if (exists(ignoreLoc)) {\n          this.addIgnoreConfig(ignoreLoc);\n          foundIgnore = true;\n        }\n      }\n\n      if (foundIgnore && foundConfig) return;\n    }\n  };\n\n  ConfigChainBuilder.prototype.addIgnoreConfig = function addIgnoreConfig(loc) {\n    var file = _fs2.default.readFileSync(loc, \"utf8\");\n    var lines = file.split(\"\\n\");\n\n    lines = lines.map(function (line) {\n      return line.replace(/#(.*?)$/, \"\").trim();\n    }).filter(function (line) {\n      return !!line;\n    });\n\n    if (lines.length) {\n      this.mergeConfig({\n        options: { ignore: lines },\n        alias: loc,\n        dirname: _path2.default.dirname(loc)\n      });\n    }\n  };\n\n  ConfigChainBuilder.prototype.addConfig = function addConfig(loc, key) {\n    var json = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _json2.default;\n\n    if (this.resolvedConfigs.indexOf(loc) >= 0) {\n      return false;\n    }\n\n    this.resolvedConfigs.push(loc);\n\n    var content = _fs2.default.readFileSync(loc, \"utf8\");\n    var options = void 0;\n\n    try {\n      options = jsonCache[content] = jsonCache[content] || json.parse(content);\n      if (key) options = options[key];\n    } catch (err) {\n      err.message = loc + \": Error while parsing JSON - \" + err.message;\n      throw err;\n    }\n\n    this.mergeConfig({\n      options: options,\n      alias: loc,\n      dirname: _path2.default.dirname(loc)\n    });\n\n    return !!options;\n  };\n\n  ConfigChainBuilder.prototype.mergeConfig = function mergeConfig(_ref) {\n    var options = _ref.options,\n        alias = _ref.alias,\n        loc = _ref.loc,\n        dirname = _ref.dirname;\n\n    if (!options) {\n      return false;\n    }\n\n    options = (0, _assign2.default)({}, options);\n\n    dirname = dirname || process.cwd();\n    loc = loc || alias;\n\n    if (options.extends) {\n      var extendsLoc = (0, _resolve2.default)(options.extends, dirname);\n      if (extendsLoc) {\n        this.addConfig(extendsLoc);\n      } else {\n        if (this.log) this.log.error(\"Couldn't resolve extends clause of \" + options.extends + \" in \" + alias);\n      }\n      delete options.extends;\n    }\n\n    this.configs.push({\n      options: options,\n      alias: alias,\n      loc: loc,\n      dirname: dirname\n    });\n\n    var envOpts = void 0;\n    var envKey = process.env.BABEL_ENV || process.env.NODE_ENV || \"development\";\n    if (options.env) {\n      envOpts = options.env[envKey];\n      delete options.env;\n    }\n\n    this.mergeConfig({\n      options: envOpts,\n      alias: alias + \".env.\" + envKey,\n      dirname: dirname\n    });\n  };\n\n  return ConfigChainBuilder;\n}();\n\nmodule.exports = exports[\"default\"];"]}