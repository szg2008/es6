{"version":3,"sources":["shadow-functions.js"],"names":[],"mappings":"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","file":"shadow-functions-compiled.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _symbol = require(\"babel-runtime/core-js/symbol\");\n\nvar _symbol2 = _interopRequireDefault(_symbol);\n\nvar _plugin = require(\"../plugin\");\n\nvar _plugin2 = _interopRequireDefault(_plugin);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar SUPER_THIS_BOUND = (0, _symbol2.default)(\"super this bound\");\n\nvar superVisitor = {\n  CallExpression: function CallExpression(path) {\n    if (!path.get(\"callee\").isSuper()) return;\n\n    var node = path.node;\n\n    if (node[SUPER_THIS_BOUND]) return;\n    node[SUPER_THIS_BOUND] = true;\n\n    path.replaceWith(t.assignmentExpression(\"=\", this.id, node));\n  }\n};\n\nexports.default = new _plugin2.default({\n  name: \"internal.shadowFunctions\",\n\n  visitor: {\n    ThisExpression: function ThisExpression(path) {\n      remap(path, \"this\");\n    },\n    ReferencedIdentifier: function ReferencedIdentifier(path) {\n      if (path.node.name === \"arguments\") {\n        remap(path, \"arguments\");\n      }\n    }\n  }\n});\n\n\nfunction shouldShadow(path, shadowPath) {\n  if (path.is(\"_forceShadow\")) {\n    return true;\n  } else {\n    return shadowPath;\n  }\n}\n\nfunction remap(path, key) {\n  var shadowPath = path.inShadow(key);\n  if (!shouldShadow(path, shadowPath)) return;\n\n  var shadowFunction = path.node._shadowedFunctionLiteral;\n\n  var currentFunction = void 0;\n  var passedShadowFunction = false;\n\n  var fnPath = path.find(function (innerPath) {\n    if (innerPath.parentPath && innerPath.parentPath.isClassProperty() && innerPath.key === \"value\") {\n      return true;\n    }\n    if (path === innerPath) return false;\n    if (innerPath.isProgram() || innerPath.isFunction()) {\n      currentFunction = currentFunction || innerPath;\n    }\n\n    if (innerPath.isProgram()) {\n      passedShadowFunction = true;\n\n      return true;\n    } else if (innerPath.isFunction() && !innerPath.isArrowFunctionExpression()) {\n      if (shadowFunction) {\n        if (innerPath === shadowFunction || innerPath.node === shadowFunction.node) return true;\n      } else {\n        if (!innerPath.is(\"shadow\")) return true;\n      }\n\n      passedShadowFunction = true;\n      return false;\n    }\n\n    return false;\n  });\n\n  if (shadowFunction && fnPath.isProgram() && !shadowFunction.isProgram()) {\n    fnPath = path.findParent(function (p) {\n      return p.isProgram() || p.isFunction();\n    });\n  }\n\n  if (fnPath === currentFunction) return;\n\n  if (!passedShadowFunction) return;\n\n  var cached = fnPath.getData(key);\n  if (cached) return path.replaceWith(cached);\n\n  var id = path.scope.generateUidIdentifier(key);\n\n  fnPath.setData(key, id);\n\n  var classPath = fnPath.findParent(function (p) {\n    return p.isClass();\n  });\n  var hasSuperClass = !!(classPath && classPath.node && classPath.node.superClass);\n\n  if (key === \"this\" && fnPath.isMethod({ kind: \"constructor\" }) && hasSuperClass) {\n    fnPath.scope.push({ id: id });\n\n    fnPath.traverse(superVisitor, { id: id });\n  } else {\n    var init = key === \"this\" ? t.thisExpression() : t.identifier(key);\n\n    if (shadowFunction) init._shadowedFunctionLiteral = shadowFunction;\n\n    fnPath.scope.push({ id: id, init: init });\n  }\n\n  return path.replaceWith(id);\n}\nmodule.exports = exports[\"default\"];"]}